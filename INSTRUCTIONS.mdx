# Scripts de gestion

### ğŸ’¡ GÃ©rer notre base de donnÃ©es

## ğŸ“ Tes notes

Detaille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Lorsque lâ€™on dÃ©veloppe et surtout avec des bases de donnÃ©es, il y a Ã©normÃ©ment de contraintes a respecter (tables correctement dÃ©finies, types, contraintes, jeux de donnÃ©es).

En tant que dÃ©veloppeur on peut vite se retrouver dans des Ã©tats incohÃ©rents.

Il est important dâ€™avoir des script permettant facilement de

- Supprimer toutes les tables et contraintes
- CrÃ©er toute les tables
- InsÃ©rer un jeux de donnÃ©es

On parle gÃ©nÃ©ralement de

- DDL (Data Definition Language) - exemple : `create-tables.sql` ,`drop.sql`
- DML (Data Manipulation Language) exemple : `seed.sql`

Pour le moment il nous faut aller dans lâ€™interface de postgres (PgAdmin ou sur Vercel) pour executer manuellement les requÃªtes. Cela peut vite devenir compliquÃ©.

Pour simplifier nous allons creer des script accessible dans le `package.json`

```json
"db:check": "tsx src/db/scripts/check.ts", // check accÃ¨s DB
"db:clear": "tsx src/db/scripts/clear.ts", // surpprime toutes les tables
"db:push": "tsx src/db/scripts/create.ts", // creer les tables
"db:seed": "tsx src/db/scripts/seed.ts", // insere des donnÃ©es
```

Pour pouvoir exÃ©cuter des scripts `TypeScript` Independent de Next, il existe TSX

ğŸ“‘ Le liens vers la doc TSX [https://www.npmjs.com/package/tsx](https://www.npmjs.com/package/tsx)

```bash
# execution du script ts check
tsx src/db/scripts/check.ts
```

Comme nous lâ€™exÃ©cution est indÃ©pendante de Next, il nâ€™y a aucun mÃ©canisme permettant de gÃ©rer les fichiers `.env.` Nous allons donc utiliser `'dotenvâ€™` qui permet de gÃ©rer cela.

```tsx
//env.ts
import * as dotenv from 'dotenv'

function initDotEnv() {
  const environment = process.env.NODE_ENV || 'development'
  const envFilePath =
    environment === 'production' ? '.env.production' : '.env.development'
  dotenv.config({path: envFilePath})
}

export default initDotEnv

```

## Exercice

Dans cet exercice tu vas devoir implÃ©menter le script de remplissage de donnÃ©es `Todo` : `seed.ts`

PS : Attention lors de la manipulation de donnÃ©es en production

Tu peux exÃ©cuter un cycle complet : `DROP / CREATE / SEED avec la commande`

```tsx
pnpm db:reset-seed
```

Fichiers

- `src/db/scripts/seed.ts`

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=Data%20Modeling&entry.533578441=02%20Les%20scripts).
