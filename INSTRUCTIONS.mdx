# Drizzle KIT - GÃ©nÃ©ration / Migration

### ğŸ’¡ Utiliser Drizzle KIT

## ğŸ“ Tes notes

DÃ©taille ce que tu as appris ici,Â surÂ uneÂ pageÂ [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Il est important dâ€™avoir un code base en phase avec la modÃ©lisation de notre base de donnÃ©es. Dans les modules prÃ©cÃ©dents, nous avions :

- Des Scripts SQL pour crÃ©er notre model de donnÃ©es.
- Notre code base.

S'assurer que tout est en phase peut Ãªtre fastidieux et lâ€™on nâ€™est jamais Ã  lâ€™abris dâ€™un oubli. Dans une application, il y a Ã  gÃ©rer le dÃ©veloppement de nouvelle `feature` mais aussi lâ€™Ã©volution.

Comment gÃ©rer la suppression, lâ€™ajout ou la modification dâ€™une table, colonne, type ? Cela peut vite devenir compliquÃ©.

### Drizzle Kit

`Drizzle kit` est un utilitaire nous permettant plusieurs choses mais les plus importantes sont :

- La gÃ©nÃ©ration du model de donnÃ©es

En gros la conversion de notre code en script SQL

```tsx
export const user = pgTable("user", {
  id: serial("id"),
  name: text("name"),
  email: text("email"),
  password: text("password"),
  role: text("role").$type<"admin" | "customer">(),
  createdAt: timestamp("created_at"),
  updatedAt: timestamp("updated_at"),
});
// tranformer en Ã§a
CREATE TABLE IF NOT EXISTS "user" (
  "id" serial,
  "name" text,
  "email" text,
  "password" text,
  "role" text,
  "created_at" timestamp,
  "updated_at" timestamp
);
```

- La gestion des migrations

Câ€™est Ã  dire les scripts permettant de passer dâ€™une version Ã  une autre.

Admettons lâ€™ajout dâ€™une colonne `isVerified: boolean("is_verified"),`

```tsx
export const user = pgTable("user", {
  id: serial("id"),
  name: text("name"),
  email: text("email"),
  password: text("password"),
  isVerified: boolean("is_verified"),
  role: text("role").$type<"admin" | "customer">(),
  createdAt: timestamp("created_at"),
  updatedAt: timestamp("updated_at"),
});
//generation
ALTER TABLE "user" ADD COLUMN "is_verified" boolean;
```

ğŸ“‘ Le lien vers la doc : [https://orm.drizzle.team/kit-docs/overview#overview](https://orm.drizzle.team/kit-docs/overview#overview)

## Exercice

Dans cet exercice, nous allons crÃ©er plusieurs scripts, la premiÃ¨re chose est dâ€™ajouter la dÃ©pendance vers `drizzle` kit :

```json
//package.json
"devDependencies": {
    "drizzle-kit": "^0.24.0",
```

Ensuite les scripts :

```json
"db:generate": "drizzle-kit generate", //generation des scripts
"db:migrate": "drizzle-kit migrate", //execution des scripts de migration
"db:drop": "drizzle-kit drop", // supression d'un script de migration
"db:reset-seed": "pnpm db:clear && pnpm db:generate && pnpm db:migrate && pnpm db:seed" // Tout renegenerer
```

**ğŸ¶** Pour que ces scripts fonctionnent, tu vas crÃ©er un fichier de configuration `drizzle`.

Fichiers

- `pacakge.json`
- `drizzle.config.ts`

## Bonus

### 1. ğŸš€ Studio

Essaie le studio (en beta) :

```json
"db:studio": "drizzle-kit studio" // permet de lancer une interface legere
```

[Se connecter Ã  lâ€™interface](https://local.drizzle.studio/)

Il est intÃ©ressant de voir que lâ€™on peut :

- ExÃ©cuter des requÃªtes `SQL`
- ExÃ©cuter des requÃªtes `Drizzle`
- Introspecter les tables dans lâ€™onglet `shema`

CrÃ©e une nouvelle table `TOTO` et constate lâ€™introspection :

```sql
CREATE TABLE TOTO (
  id SERIAL PRIMARY KEY,
  title VARCHAR(255) NOT NULL,
  isCompleted BOOLEAN NOT NULL,
  createdAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  updatedAt TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

Fichiers

- `package.json`

## Aller plus loin

ğŸ“‘ Le lien vers la doc [https://orm.drizzle.team/kit-docs/overview](https://orm.drizzle.team/kit-docs/overview)

## Ils vont tâ€™aider

- **ğŸ¶ Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **ğŸ¤– Ash le Robot** : _Ash le Robot te donnera du code utile._
- **ğŸš€ Julia La roquette** : _Julia te donnera des dÃ©fis supplÃ©mentaires._
- **â›ï¸ Hulk le Marteau** : _Quand du code Ã  supprimer est prÃ©sent_
- **ğŸ‘¨â€âœˆï¸ Hugo le chef de projet** : _Va t'aider sur les spÃ©cifications du projet_

## ğŸœ Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=06.Data%20Modeling&entry.533578441=05%20Drizzle%20Kit).
