# Relation One To One

### 💡 Comprendre les relations 1-1

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Rappel

Voici un bref rappel des types de relations en bases de données relationnelles :

### 1. Relation **1-1** (One-to-One)

- **Description** : Chaque enregistrement dans une table A correspond à un seul enregistrement dans une table B, et vice versa.
- **Exemple** : Un utilisateur (`users`) et son profil détaillé (`user_profiles`). Chaque utilisateur a un profil unique.
- **Implémentation** : Utilisation d'une clé étrangère (foreign key) avec une contrainte d'unicité (`UNIQUE`) dans l'une des tables.

### 2. Relation **1-N** (One-to-Many)

- **Description** : Un enregistrement dans la table A peut être associé à plusieurs enregistrements dans la table B, mais chaque enregistrement dans la table B est lié à un seul enregistrement dans la table A.
- **Exemple** : Un auteur (`authors`) et ses livres (`books`). Un auteur peut avoir plusieurs livres, mais chaque livre a un seul auteur.
- **Implémentation** : La table B contient une clé étrangère qui pointe vers la clé primaire de la table A.

### 3. Relation **N-N** (Many-to-Many)

- **Description** : Un enregistrement dans la table A peut être associé à plusieurs enregistrements dans la table B, et vice versa.
- **Exemple** : Les étudiants (`students`) et les cours (`courses`). Un étudiant peut suivre plusieurs cours, et un cours peut être suivi par plusieurs étudiants.
- **Implémentation** : Création d'une table de jonction (ou d'association) avec deux clés étrangères, une pointant vers la table A et l'autre vers la table B.

Pour créer des relation en SQL il faut plusieurs tables contenant chacune une `PK (Primary Key)`. La liaison se fait via un clef étrangère, `FK (Foreign Key)`. On utilise `REFERENCES` pour définir la FK. Exemple :

```sql
CREATE TABLE users (
    id serial PRIMARY KEY,
    name text NOT NULL
);

CREATE TABLE orders (
    id serial PRIMARY KEY,
    user_id integer NOT NULL,
    order_date date NOT NULL,
    FOREIGN KEY (user_id) REFERENCES users(id)
);
```

### Drizzle : relation / références

Pour définir des relations avec `Drizzle` nous avons besoin de 2 choses :

- Définir les FK (avec `references`), cela applique les contraintes sur la BDD
  - Doc : https://orm.drizzle.team/docs/rqb#foreign-keys
- Définir les Relation (Au niveau applicatif avec `relation`)
  - Doc : https://orm.drizzle.team/docs/rqb#one-to-one

Exemple de définition de relation 1-1

```tsx
import { pgTable, serial, text, integer, boolean } from 'drizzle-orm/pg-core';
import { relations } from 'drizzle-orm';

//table 1
export const users = pgTable('users', {
  id: serial('id').primaryKey(),
  name: text('name'),
});
//table 2
export const profileInfo = pgTable('profile_info', {
  id: serial('id').primaryKey(),
  userId: integer("user_id").references(() => users.id), // FK
  metadata: jsonb("metadata"),
});
//RELATION
export const usersRelations = relations(users, ({ one, many }) => ({
  profileInfo: one(users, {
    fields: [profileInfo.userId],
    references: [users.id],
  }),
}));

```

📑 Le liens vers la doc [https://fr.reactjs.org/docs/getting-started.html](https://fr.reactjs.org/docs/getting-started.html)

Des frameworks JavaScript modernes ont donc été créés pour relever certains des défis en créant par programme le DOM plutôt que de le définir à la main HTML.

## Exercice

**🐶D**ans cet exercice tu vas devoir créer une relation 1-1 entre `USER` et `PROFILEINFO`

Fichiers

- `src/db/schema/user.ts`

## Bonus

### 1. 🚀 Query

La puissance de l’ORM réside également dans le fait que lorsque l’on définis correctement les relations, il est très simple d’accéder aux données ainsi que les données associé au lieu d’avoir a faire plusieurs requêtes SQL séparés ou une grosse requêtes complexe avec des jointures.

**🐶** Dans cet exercice tu vas appeler `USER` et demander d’avoir le profil avec pour afficher la note

📑 Le lien vers la doc [https://orm.drizzle.team/docs/rqb](https://orm.drizzle.team/docs/rqb)

Fichiers

- `exercise/relation-one/page`

## Aller plus loin

📑 Le lien vers la doc [https://orm.drizzle.team/docs/rqb](https://orm.drizzle.team/docs/rqb)

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=Data%20Modeling&entry.533578441=06%20Relation%201-1).
