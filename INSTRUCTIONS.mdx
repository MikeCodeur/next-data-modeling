# Scripts de gestion

### 💡 Gérer notre base de données

## 📝 Tes notes

Detaille ce que tu as appris ici, sur une page [Notion](https://go.mikecodeur.com/course-notes-template)

## Comprendre

Lorsque l’on développe et surtout avec des bases de données, il y a énormément de contraintes a respecter (tables correctement définies, types, contraintes, jeux de données).

En tant que développeur on peut vite se retrouver dans des états incohérents.

Il est important d’avoir des script permettant facilement de

- Supprimer toutes les tables et contraintes
- Créer toute les tables
- Insérer un jeux de données

On parle généralement de

- DDL (Data Definition Language) - exemple : `create-tables.sql` ,`drop.sql`
- DML (Data Manipulation Language) exemple : `seed.sql`

Pour le moment il nous faut aller dans l’interface de postgres (PgAdmin ou sur Vercel) pour executer manuellement les requêtes. Cela peut vite devenir compliqué.

Pour simplifier nous allons creer des script accessible dans le `package.json`

```json
"db:check": "tsx src/db/scripts/check.ts", // check accès DB
"db:clear": "tsx src/db/scripts/clear.ts", // surpprime toutes les tables
"db:push": "tsx src/db/scripts/create.ts", // creer les tables
"db:seed": "tsx src/db/scripts/seed.ts", // insere des données
```

Pour pouvoir exécuter des scripts `TypeScript` Independent de Next, il existe TSX

📑 Le liens vers la doc TSX [https://www.npmjs.com/package/tsx](https://www.npmjs.com/package/tsx)

```bash
# execution du script ts check
tsx src/db/scripts/check.ts
```

Comme nous l’exécution est indépendante de Next, il n’y a aucun mécanisme permettant de gérer les fichiers `.env.` Nous allons donc utiliser `'dotenv’` qui permet de gérer cela.

```tsx
//env.ts
import * as dotenv from 'dotenv'

function initDotEnv() {
  const environment = process.env.NODE_ENV || 'development'
  const envFilePath =
    environment === 'production' ? '.env.production' : '.env.development'
  dotenv.config({path: envFilePath})
}

export default initDotEnv

```

## Exercice

Dans cet exercice tu vas devoir implémenter le script de remplissage de données `Todo` : `seed.ts`

PS : Attention lors de la manipulation de données en production

Tu peux exécuter un cycle complet : `DROP / CREATE / SEED avec la commande`

```tsx
pnpm db:reset-seed
```

Fichiers

- `src/db/scripts/seed.ts`

## Ils vont t’aider

- **🐶 Mowgli le Chien** : _Mowgli te guidera dans chaque exercice._
- **🤖 Ash le Robot** : _Ash le Robot te donnera du code utile._
- **🚀 Julia La roquette** : _Julia te donnera des défis supplémentaires._
- **⛏️ Hulk le Marteau** : _Quand du code à supprimer est présent_
- **👨‍✈️ Hugo le chef de projet** : _Va t'aider sur les spécifications du projet_

## 🐜 Feedback

Remplir le formulaire le [formulaire de FeedBack](https://go.mikecodeur.com/cours-next-avis?entry.1912869708=Next%20PRO&entry.1430994900=Data%20Modeling&entry.533578441=02%20Les%20scripts).
